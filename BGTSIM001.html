<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Siphiwe Bogatsu">
<meta name="dcterms.date" content="2024-09-25">

<title>Recommender Systems</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="BGTSIM001_files/libs/clipboard/clipboard.min.js"></script>
<script src="BGTSIM001_files/libs/quarto-html/quarto.js"></script>
<script src="BGTSIM001_files/libs/quarto-html/popper.min.js"></script>
<script src="BGTSIM001_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="BGTSIM001_files/libs/quarto-html/anchor.min.js"></script>
<link href="BGTSIM001_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="BGTSIM001_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="BGTSIM001_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="BGTSIM001_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="BGTSIM001_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Recommender Systems</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Siphiwe Bogatsu </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 25, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>“Is YouTube listening to us?!” my close friend, Qhawe, often exclaims in disbelief when YouTube recommends videos that perfectly match their tastes. This sentiment reflects a broader reality: many of our digital interactions are stored and analyzed, giving researchers the chance to study socio-economic and techno-social systems in greater detail (Lu et al., 2019). Recommendation systems, like those used by YouTube and other tech giants, are designed to predict user preferences based on past behavior. These systems play a crucial role in e-commerce and streaming platforms such as Netflix, YouTube, and Amazon, where making accurate recommendations increases user satisfaction and engagement, ultimately driving sales and profit growth. Companies competing for customer loyalty rely heavily on systems that analyze user preferences to offer products and services most likely to appeal to them.</p>
<p>There are two main types of recommendation systems:</p>
<ul>
<li><p>Content-based recommendation systems</p></li>
<li><p>Collaborative filtering (user-based and item-based)</p></li>
</ul>
<p>Additionally, matrix factorization is a key technique used in collaborative filtering.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-3598980764.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>In this project, I focus on collaborative filtering and matrix factorization techniques to build an ensemble recommendation system for books. The goal is to recommend books based on users’ past reading choices. This paper is structured as follows.</p>
</section>
<section id="load-packages" class="level2">
<h2 class="anchored" data-anchor-id="load-packages">Load Packages</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(<span class="st">"tidyverse"</span>, <span class="st">"skimr"</span>, <span class="st">"Metrics"</span>, <span class="st">"recosystem"</span>, <span class="st">"tools"</span>, <span class="st">"caret"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="books-dataset" class="level2">
<h2 class="anchored" data-anchor-id="books-dataset">Books Dataset</h2>
<p>The data was collected by Cai-Nicolas Ziegler in 2004 from a <a href="https://www.bookcrossing.com/">Book Crossing Community</a>. It contains 278 878 users with 1 149 780 ratings. It is divided into three subsets: users, books and ratings. Let’s start with books</p>
<section id="data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="data-preparation">Data Preparation</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>books   <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"Books.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>books <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">3</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 3%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 21%">
<col style="width: 21%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">ISBN</th>
<th style="text-align: left;">Book.Title</th>
<th style="text-align: left;">Book.Author</th>
<th style="text-align: left;">Year.Of.Publication</th>
<th style="text-align: left;">Publisher</th>
<th style="text-align: left;">Image.URL.S</th>
<th style="text-align: left;">Image.URL.M</th>
<th style="text-align: left;">Image.URL.L</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0195153448</td>
<td style="text-align: left;">Classical Mythology</td>
<td style="text-align: left;">Mark P. O. Morford</td>
<td style="text-align: left;">2002</td>
<td style="text-align: left;">Oxford University Press</td>
<td style="text-align: left;">http://images.amazon.com/images/P/0195153448.01.THUMBZZZ.jpg</td>
<td style="text-align: left;">http://images.amazon.com/images/P/0195153448.01.MZZZZZZZ.jpg</td>
<td style="text-align: left;">http://images.amazon.com/images/P/0195153448.01.LZZZZZZZ.jpg</td>
</tr>
<tr class="even">
<td style="text-align: left;">0002005018</td>
<td style="text-align: left;">Clara Callan</td>
<td style="text-align: left;">Richard Bruce Wright</td>
<td style="text-align: left;">2001</td>
<td style="text-align: left;">HarperFlamingo Canada</td>
<td style="text-align: left;">http://images.amazon.com/images/P/0002005018.01.THUMBZZZ.jpg</td>
<td style="text-align: left;">http://images.amazon.com/images/P/0002005018.01.MZZZZZZZ.jpg</td>
<td style="text-align: left;">http://images.amazon.com/images/P/0002005018.01.LZZZZZZZ.jpg</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0060973129</td>
<td style="text-align: left;">Decision in Normandy</td>
<td style="text-align: left;">Carlo D’Este</td>
<td style="text-align: left;">1991</td>
<td style="text-align: left;">HarperPerennial</td>
<td style="text-align: left;">http://images.amazon.com/images/P/0060973129.01.THUMBZZZ.jpg</td>
<td style="text-align: left;">http://images.amazon.com/images/P/0060973129.01.MZZZZZZZ.jpg</td>
<td style="text-align: left;">http://images.amazon.com/images/P/0060973129.01.LZZZZZZZ.jpg</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># exclude the images variables</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>books <span class="ot">=</span> books <span class="sc">|&gt;</span> <span class="fu">select</span>(ISBN,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                        Book.Title,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                        Book.Author,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                        Year.Of.Publication,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                        Publisher)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># change to lowercase. it makes life easier</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>books<span class="sc">$</span>Book.Title  <span class="ot">=</span> books<span class="sc">$</span>Book.Title <span class="sc">|&gt;</span> <span class="fu">str_to_lower</span>()</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>books<span class="sc">$</span>Book.Author <span class="ot">=</span> books<span class="sc">$</span>Book.Author <span class="sc">|&gt;</span> <span class="fu">str_to_lower</span>()</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>books<span class="sc">$</span>Publisher   <span class="ot">=</span> books<span class="sc">$</span>Publisher <span class="sc">|&gt;</span> <span class="fu">str_to_lower</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Books data contains <em>ISBN</em>, <em>Book Title</em>, <em>Book Author</em>, <em>Publication Year</em>, <em>Publishing Company</em> and images as its variables to describe a book observation.</p>
<p>Let’s do some wrangling on interesting variables</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Looks like year of publication has some issues: "dk publishing inc" and "gallimard" issue. </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>books <span class="sc">|&gt;</span> <span class="fu">filter</span>(Year.Of.Publication <span class="sc">==</span> <span class="st">"dk publishing inc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] ISBN                Book.Title          Book.Author        
[4] Year.Of.Publication Publisher          
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>books<span class="sc">$</span>Publisher[books<span class="sc">$</span>Publisher <span class="sc">%in%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="st">"http://images.amazon.com/images/P/078946697X.01.THUMBZZZ.jpg"</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"http://images.amazon.com/images/P/0789466953.01.THUMBZZZ.jpg"</span>)] <span class="ot">=</span> <span class="st">"dk publishing inc"</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Put the correct date </span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>books<span class="sc">$</span>Year.Of.Publication[books<span class="sc">$</span>Year.Of.Publication <span class="sc">==</span> <span class="st">"dk publishing inc"</span>] <span class="ot">=</span> <span class="st">"2000"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>books<span class="sc">|&gt;</span> <span class="fu">filter</span>(Publisher <span class="sc">==</span> <span class="st">"dk publishing inc"</span> <span class="sc">&amp;</span> Book.Author <span class="sc">==</span> <span class="st">"2000"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] ISBN                Book.Title          Book.Author        
[4] Year.Of.Publication Publisher          
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Some author variables had "2000" instead of the correct names. </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>books<span class="sc">$</span>Book.Author[books<span class="sc">$</span>Book.Author <span class="sc">%in%</span> <span class="st">"2000"</span> <span class="sc">&amp;</span> books<span class="sc">$</span>ISBN <span class="sc">%in%</span> <span class="st">"078946697X"</span> ] <span class="ot">=</span> <span class="st">"michael teitelbaum"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>books<span class="sc">$</span>Book.Author[books<span class="sc">$</span>Book.Author <span class="sc">%in%</span> <span class="st">"2000"</span> <span class="sc">&amp;</span> books<span class="sc">$</span>ISBN <span class="sc">%in%</span> <span class="st">"0789466953"</span> ] <span class="ot">=</span> <span class="st">"james buckley"</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>books<span class="sc">$</span>Book.Title[books<span class="sc">$</span>Book.Author <span class="sc">%in%</span> <span class="st">"michael teitelbaum"</span> <span class="sc">&amp;</span> books<span class="sc">$</span>ISBN <span class="sc">%in%</span> <span class="st">"078946697X"</span> ] <span class="ot">=</span> <span class="st">"DK Readers: Creating the X-Men, How It All Began (Level 4: Proficient Readers)"</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>books<span class="sc">$</span>Book.Title[books<span class="sc">$</span>Book.Author <span class="sc">%in%</span> <span class="st">"james buckley"</span> <span class="sc">&amp;</span> books<span class="sc">$</span>ISBN <span class="sc">%in%</span> <span class="st">"0789466953"</span> ] <span class="ot">=</span> <span class="st">"DK Readers: Creating the X-Men, How Comic Books Come to Life (Level 4: Proficient Readers)"</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>books <span class="sc">|&gt;</span> <span class="fu">filter</span>(Publisher <span class="sc">==</span> <span class="st">"dk publishing inc"</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 43%">
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">ISBN</th>
<th style="text-align: left;">Book.Title</th>
<th style="text-align: left;">Book.Author</th>
<th style="text-align: left;">Year.Of.Publication</th>
<th style="text-align: left;">Publisher</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0789495929</td>
<td style="text-align: left;">sharks (dk pockets)</td>
<td style="text-align: left;">joyce pope</td>
<td style="text-align: left;">2003</td>
<td style="text-align: left;">dk publishing inc</td>
</tr>
<tr class="even">
<td style="text-align: left;">0789426277</td>
<td style="text-align: left;">forgotten fire</td>
<td style="text-align: left;">adam bagdasarian</td>
<td style="text-align: left;">2000</td>
<td style="text-align: left;">dk publishing inc</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0789420279</td>
<td style="text-align: left;">children just like me: celebrations!</td>
<td style="text-align: left;">anabel kindersley</td>
<td style="text-align: left;">1997</td>
<td style="text-align: left;">dk publishing inc</td>
</tr>
<tr class="even">
<td style="text-align: left;">0789488914</td>
<td style="text-align: left;">crime scene: the ultimate guide to forensic science</td>
<td style="text-align: left;">richard platt</td>
<td style="text-align: left;">2003</td>
<td style="text-align: left;">dk publishing inc</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0789458063</td>
<td style="text-align: left;">eyewitness: early humans</td>
<td style="text-align: left;">nick merriman</td>
<td style="text-align: left;">2000</td>
<td style="text-align: left;">dk publishing inc</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## gallimard now. </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>books <span class="sc">|&gt;</span> <span class="fu">filter</span>(Year.Of.Publication <span class="sc">==</span> <span class="st">"gallimard"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] ISBN                Book.Title          Book.Author        
[4] Year.Of.Publication Publisher          
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>books<span class="sc">$</span>Publisher[books<span class="sc">$</span>Publisher <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"http://images.amazon.com/images/P/2070426769.01.THUMBZZZ.jpg"</span>,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"http://images.amazon.com/images/P/2070426769.01.THUMBZZZ.jpg"</span>)] <span class="ot">=</span> <span class="st">"gallimard"</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>books<span class="sc">$</span>Year.Of.Publication[books<span class="sc">$</span>Year.Of.Publication <span class="sc">==</span> <span class="st">"gallimard"</span>] <span class="ot">=</span> <span class="st">"2003"</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>books<span class="sc">|&gt;</span> <span class="fu">filter</span>(Publisher <span class="sc">==</span> <span class="st">"gallimard"</span> <span class="sc">&amp;</span> Book.Author <span class="sc">==</span> <span class="st">"2003"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] ISBN                Book.Title          Book.Author        
[4] Year.Of.Publication Publisher          
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>books<span class="sc">$</span>Book.Author[books<span class="sc">$</span>Book.Author <span class="sc">%in%</span> <span class="st">"2003"</span> <span class="sc">&amp;</span> books<span class="sc">$</span>ISBN <span class="sc">%in%</span> <span class="st">"2070426769"</span> ] <span class="ot">=</span> <span class="st">"Jean-Marie Gustave Le ClÃ?Â©zio"</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>books<span class="sc">$</span>Book.Title[books<span class="sc">$</span>Book.Author <span class="sc">%in%</span> <span class="st">"Jean-Marie Gustave Le ClÃ?Â©zio"</span> <span class="sc">&amp;</span> books<span class="sc">$</span>ISBN <span class="sc">%in%</span> <span class="st">"2070426769"</span> ] <span class="ot">=</span> <span class="st">"Peuple du ciel, suivi de 'Les Bergers"</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>books <span class="sc">|&gt;</span> <span class="fu">filter</span>(Publisher <span class="sc">==</span> <span class="st">"gallimard"</span>) </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>      <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 32%">
<col style="width: 22%">
<col style="width: 22%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">ISBN</th>
<th style="text-align: left;">Book.Title</th>
<th style="text-align: left;">Book.Author</th>
<th style="text-align: left;">Year.Of.Publication</th>
<th style="text-align: left;">Publisher</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2070423204</td>
<td style="text-align: left;">lieux dits</td>
<td style="text-align: left;">michel tournier</td>
<td style="text-align: left;">2002</td>
<td style="text-align: left;">gallimard</td>
</tr>
<tr class="even">
<td style="text-align: left;">2070417743</td>
<td style="text-align: left;">chroniques martiennes</td>
<td style="text-align: left;">ray bradbury</td>
<td style="text-align: left;">2002</td>
<td style="text-align: left;">gallimard</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2070384349</td>
<td style="text-align: left;">la faute de l’abbã?â© mouret</td>
<td style="text-align: left;">emile zola</td>
<td style="text-align: left;">1991</td>
<td style="text-align: left;">gallimard</td>
</tr>
<tr class="even">
<td style="text-align: left;">2070417700</td>
<td style="text-align: left;">deus irae</td>
<td style="text-align: left;">philip kindred dick</td>
<td style="text-align: left;">2001</td>
<td style="text-align: left;">gallimard</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2070360075</td>
<td style="text-align: left;">le vieil homme et la mer</td>
<td style="text-align: left;">ernest hemingway</td>
<td style="text-align: left;">1972</td>
<td style="text-align: left;">gallimard</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The data was published in August/September 2004. Thus, any publication year above that should be dealt with: anything beyond 2005 should be given an NA, and impute the mean year of the whole data set.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>books<span class="sc">$</span>Year.Of.Publication <span class="ot">=</span> books<span class="sc">$</span>Year.Of.Publication <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>books <span class="ot">=</span> books <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year.Of.Publication =</span> <span class="fu">ifelse</span>(Year.Of.Publication <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> Year.Of.Publication <span class="sc">&gt;=</span> <span class="dv">2005</span>, <span class="cn">NA</span>, Year.Of.Publication))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># replace NAs with the mean of the years of publication </span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>books <span class="ot">=</span> books <span class="sc">|&gt;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year.Of.Publication =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Year.Of.Publication),</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">round</span>(<span class="fu">mean</span>(Year.Of.Publication, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>                                      Year.Of.Publication))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># check </span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>books <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(Year.Of.Publication)) <span class="sc">|&gt;</span> <span class="fu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>Let’s move to the <em>Publisher</em> variable now.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## are there NAs in the publisher column ? </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>books<span class="sc">$</span>Publisher[books<span class="sc">$</span>Publisher <span class="sc">|&gt;</span> <span class="fu">is.na</span>()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>character(0)</code></pre>
</div>
</div>
<p>Okay. Enough about the <strong>Books</strong> data for a minute. Let me load the <strong>Users</strong> data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>users <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"users.csv"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># how is age distributed for our users ?</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>users <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(Age)) <span class="sc">+</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"magenta"</span>, <span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Count"</span>, </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Age in years"</span>, </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Some users are less than 5 years old and some are even over 100 years?!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="BGTSIM001_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># That's kinda sus. To be safe, I remove these. </span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>users <span class="ot">=</span> users <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">filter</span>(Age <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">100</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># replace all the NAs with the mean of Age </span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>users <span class="ot">=</span> users <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Age =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Age), </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">round</span>(<span class="fu">mean</span>(Age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>                               Age)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co"># check </span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>users <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(Age)) <span class="sc">|&gt;</span> <span class="fu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># box plot? </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>users <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(Age)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"magenta"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="BGTSIM001_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>The mean <em>age</em> is around 30 years old. Most of the book readers lie between the ages of 25 to little less than 45 years old - which is kind of expected.</p>
<p>Let’s add the Ratings data. This will have <em>n_users*n_books</em> entries if every user rated every item. From this, I can confidently speculate that the dataset is very sparse</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ratings <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"ratings.csv"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(ratings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">ratings</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">1149780</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ISBN</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">340556</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">User.ID</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">140386.40</td>
<td style="text-align: right;">80562.28</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">70345</td>
<td style="text-align: right;">141010</td>
<td style="text-align: right;">211028</td>
<td style="text-align: right;">278854</td>
<td style="text-align: left;">▇▇▇▇▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">Book.Rating</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.87</td>
<td style="text-align: right;">3.85</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">▇▁▁▂▂</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Let’s merge our all the three data sets.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let's merge books and ratings. ratings dataset should have books only which exist in our books dataset, unless new books are added to books dataset</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>ratings_new <span class="ot">=</span> <span class="fu">inner_join</span>(ratings, books)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">#ratings dataset should have ratings from users which exist in users dataset, unless new users are added to users dataset</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>ratings_new <span class="ot">=</span> <span class="fu">inner_join</span>(users, ratings_new)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(ratings_new <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 14%">
<col style="width: 2%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 32%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">User.ID</th>
<th style="text-align: left;">Location</th>
<th style="text-align: right;">Age</th>
<th style="text-align: left;">ISBN</th>
<th style="text-align: right;">Book.Rating</th>
<th style="text-align: left;">Book.Title</th>
<th style="text-align: left;">Book.Author</th>
<th style="text-align: right;">Year.Of.Publication</th>
<th style="text-align: left;">Publisher</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">stockton, california, usa</td>
<td style="text-align: right;">18</td>
<td style="text-align: left;">0195153448</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">classical mythology</td>
<td style="text-align: left;">mark p.&nbsp;o. morford</td>
<td style="text-align: right;">2002</td>
<td style="text-align: left;">oxford university press</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: left;">albacete, wisconsin, spain</td>
<td style="text-align: right;">26</td>
<td style="text-align: left;">1841721522</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">new vegetarian: bold and beautiful recipes for every occasion</td>
<td style="text-align: left;">celia brooks brown</td>
<td style="text-align: right;">2001</td>
<td style="text-align: left;">ryland peters &amp; small ltd</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: left;">weston, ,</td>
<td style="text-align: right;">14</td>
<td style="text-align: left;">0375759778</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">prague : a novel</td>
<td style="text-align: left;">arthur phillips</td>
<td style="text-align: right;">2003</td>
<td style="text-align: left;">random house trade paperbacks</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: left;">langhorne, pennsylvania, usa</td>
<td style="text-align: right;">19</td>
<td style="text-align: left;">0425163091</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">chocolate jesus</td>
<td style="text-align: left;">stephan jaramillo</td>
<td style="text-align: right;">1998</td>
<td style="text-align: left;">berkley publishing group</td>
</tr>
<tr class="odd">
<td style="text-align: right;">36</td>
<td style="text-align: left;">montreal, quebec, canada</td>
<td style="text-align: right;">24</td>
<td style="text-align: left;">067176537X</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">the therapeutic touch: how to use your hands to help or to heal</td>
<td style="text-align: left;">dolores krieger</td>
<td style="text-align: right;">1979</td>
<td style="text-align: left;">fireside</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>When merging the ratings and books data, there is evidence that some ratings did not have books on them. They eventually got dropped off.</li>
<li>When merging the ratings(plus books) data, there is evidence that some users did not have ratings on them. They eventually got dropped off.</li>
</ul>
<p>Ratings are either explicit, expressed on a scale from 1-10 higher values denoting higher appreciation, or implicit, expressed by 0. Just for ease, I focus only on books with users that gave explicit ratings.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># split according to explicit and implicit ratings. </span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>ratings_explicit <span class="ot">=</span> ratings_new <span class="sc">|&gt;</span> <span class="fu">filter</span>(Book.Rating <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>ratings_implicit <span class="ot">=</span> ratings_new <span class="sc">|&gt;</span> <span class="fu">filter</span>(Book.Rating <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># bar graph for explicit ratings </span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>ratings_explicit <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(Book.Rating)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Count"</span>, </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Book Rating"</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Users appear to mostly enjoy the books they read."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="BGTSIM001_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="what-are-the-top-10-most-popular-books" class="level2">
<h2 class="anchored" data-anchor-id="what-are-the-top-10-most-popular-books">What are the top 10 most popular books ?</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>ratings_explicit <span class="sc">|&gt;</span> <span class="fu">group_by</span>(Book.Title) <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(Book.Rating)) <span class="sc">|&gt;</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">10</span>)<span class="sc">|&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">select</span>(Book.Title, count)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 91%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Book.Title</th>
<th style="text-align: right;">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">the lovely bones: a novel</td>
<td style="text-align: right;">3862</td>
</tr>
<tr class="even">
<td style="text-align: left;">the da vinci code</td>
<td style="text-align: right;">3188</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the secret life of bees</td>
<td style="text-align: right;">2348</td>
</tr>
<tr class="even">
<td style="text-align: left;">harry potter and the chamber of secrets (book 2)</td>
<td style="text-align: right;">2150</td>
</tr>
<tr class="odd">
<td style="text-align: left;">wild animus</td>
<td style="text-align: right;">2113</td>
</tr>
<tr class="even">
<td style="text-align: left;">angels &amp; demons</td>
<td style="text-align: right;">2041</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bridget jones’s diary</td>
<td style="text-align: right;">2029</td>
</tr>
<tr class="even">
<td style="text-align: left;">life of pi</td>
<td style="text-align: right;">2008</td>
</tr>
<tr class="odd">
<td style="text-align: left;">harry potter and the sorcerer’s stone (harry potter (paperback))</td>
<td style="text-align: right;">1965</td>
</tr>
<tr class="even">
<td style="text-align: left;">harry potter and the prisoner of azkaban (book 3)</td>
<td style="text-align: right;">1952</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="which-publishing-companies-are-rated-most-popular" class="level2">
<h2 class="anchored" data-anchor-id="which-publishing-companies-are-rated-most-popular">Which publishing companies are rated most popular ?</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>pub_companies <span class="ot">=</span> ratings_explicit <span class="sc">|&gt;</span> <span class="fu">group_by</span>(Publisher) <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(Book.Rating)) <span class="sc">|&gt;</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">20</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(pub_companies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Publisher</th>
<th style="text-align: right;">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ballantine books</td>
<td style="text-align: right;">65469</td>
</tr>
<tr class="even">
<td style="text-align: left;">pocket</td>
<td style="text-align: right;">55889</td>
</tr>
<tr class="odd">
<td style="text-align: left;">berkley publishing group</td>
<td style="text-align: right;">47092</td>
</tr>
<tr class="even">
<td style="text-align: left;">warner books</td>
<td style="text-align: right;">45344</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bantam</td>
<td style="text-align: right;">41036</td>
</tr>
<tr class="even">
<td style="text-align: left;">penguin books</td>
<td style="text-align: right;">36807</td>
</tr>
<tr class="odd">
<td style="text-align: left;">signet book</td>
<td style="text-align: right;">36763</td>
</tr>
<tr class="even">
<td style="text-align: left;">bantam books</td>
<td style="text-align: right;">36464</td>
</tr>
<tr class="odd">
<td style="text-align: left;">perennial</td>
<td style="text-align: right;">29798</td>
</tr>
<tr class="even">
<td style="text-align: left;">avon</td>
<td style="text-align: right;">29605</td>
</tr>
<tr class="odd">
<td style="text-align: left;">harlequin</td>
<td style="text-align: right;">27622</td>
</tr>
<tr class="even">
<td style="text-align: left;">jove books</td>
<td style="text-align: right;">24270</td>
</tr>
<tr class="odd">
<td style="text-align: left;">harpercollins</td>
<td style="text-align: right;">24137</td>
</tr>
<tr class="even">
<td style="text-align: left;">scholastic</td>
<td style="text-align: right;">23285</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vintage books usa</td>
<td style="text-align: right;">23260</td>
</tr>
<tr class="even">
<td style="text-align: left;">dell</td>
<td style="text-align: right;">22692</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dell publishing company</td>
<td style="text-align: right;">20922</td>
</tr>
<tr class="even">
<td style="text-align: left;">harpertorch</td>
<td style="text-align: right;">20614</td>
</tr>
<tr class="odd">
<td style="text-align: left;">simon &amp; schuster</td>
<td style="text-align: right;">19366</td>
</tr>
<tr class="even">
<td style="text-align: left;">silhouette</td>
<td style="text-align: right;">18247</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><a href="https://www.randomhousebooks.com/imprint/ballantine-books/">Ballantine Books</a> and <a href="https://en.wikipedia.org/wiki/Pocket_Books">Pocket Books</a> are rated popular by our users.</p>
</section>
<section id="which-books-did-ballantine-books-publish-which-one-is-the-highly-rated-by-the-users" class="level2">
<h2 class="anchored" data-anchor-id="which-books-did-ballantine-books-publish-which-one-is-the-highly-rated-by-the-users">Which books did Ballantine Books publish ? Which one is the highly-rated by the users ?</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>ratings_explicit <span class="sc">|&gt;</span> <span class="fu">filter</span>(Publisher <span class="sc">==</span> <span class="st">"ballantine books"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">group_by</span>(Book.Title) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(Book.Rating)) <span class="sc">|&gt;</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Book.Title</th>
<th style="text-align: right;">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">interview with the vampire</td>
<td style="text-align: right;">1437</td>
</tr>
<tr class="even">
<td style="text-align: left;">jurassic park</td>
<td style="text-align: right;">1163</td>
</tr>
<tr class="odd">
<td style="text-align: left;">a prayer for owen meany</td>
<td style="text-align: right;">943</td>
</tr>
<tr class="even">
<td style="text-align: left;">the vampire lestat (vampire chronicles, book ii)</td>
<td style="text-align: right;">910</td>
</tr>
<tr class="odd">
<td style="text-align: left;">timeline</td>
<td style="text-align: right;">872</td>
</tr>
<tr class="even">
<td style="text-align: left;">sphere</td>
<td style="text-align: right;">726</td>
</tr>
<tr class="odd">
<td style="text-align: left;">while i was gone</td>
<td style="text-align: right;">656</td>
</tr>
<tr class="even">
<td style="text-align: left;">seabiscuit: an american legend</td>
<td style="text-align: right;">623</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the queen of the damned (vampire chronicles (paperback))</td>
<td style="text-align: right;">588</td>
</tr>
<tr class="even">
<td style="text-align: left;">the witching hour (lives of the mayfair witches)</td>
<td style="text-align: right;">573</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Interview With The Vampire by Anna Rice and Jurassic Park by Michael Crichton are among the highly rated books published under Ballantine Books - the highly-rated publisher in the data.</p>
</section>
<section id="who-is-the-highly-rated-author-and-which-books-they-wrote" class="level2">
<h2 class="anchored" data-anchor-id="who-is-the-highly-rated-author-and-which-books-they-wrote">Who is the highly-rated author and which books they wrote ?</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ratings_explicit <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Book.Author) <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(Book.Rating)) <span class="sc">|&gt;</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">|&gt;</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Book.Author, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Author"</span>, </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"User Rating Count"</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Stephen King, ahead of John Grisham, is the user's favorite book author!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="BGTSIM001_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<section id="what-books-did-stephen-king-publish-and-how-are-they-rated" class="level3">
<h3 class="anchored" data-anchor-id="what-books-did-stephen-king-publish-and-how-are-they-rated">What books did Stephen King publish, and how are they rated ?</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>stephen <span class="ot">=</span> ratings_explicit <span class="sc">|&gt;</span> <span class="fu">filter</span>(Book.Author <span class="sc">==</span> <span class="st">"stephen king"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">group_by</span>(Book.Title) <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(Book.Rating)) <span class="sc">|&gt;</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">select</span>(Book.Title, count) <span class="sc">|&gt;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Book.Title, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">geom_col</span>( <span class="at">fill =</span> <span class="st">"magenta"</span>) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span> <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">"Book Title"</span>, </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">"User Rating Count"</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="st">"Stephen King's books are recieved by users in roughly the same manner"</span>,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">subtitle =</span> <span class="st">"Dream Catcher (Science Fiction) and Misery (Horror) are the top-rated books in his shelf"</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>stephen    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="BGTSIM001_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="which-publisher-of-stephen-kings-books-is-highly-rated" class="level3">
<h3 class="anchored" data-anchor-id="which-publisher-of-stephen-kings-books-is-highly-rated">Which publisher of Stephen King’s books is highly rated ?</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ratings_explicit <span class="sc">|&gt;</span> <span class="fu">filter</span>(Book.Author <span class="sc">==</span> <span class="st">"stephen king"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">group_by</span>(Publisher) <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(Book.Rating)) <span class="sc">|&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">|&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Publisher, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"gold"</span>) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Publisher"</span>, </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> <span class="st">"User Rating Count"</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">title =</span> <span class="st">"Signet Book has published Stephen King's highly-rated books."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="BGTSIM001_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>But, wait…What if this observation could be explained by Signet Book publishing many of Stephen King’s books than any other publisher?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>ratings_explicit <span class="sc">|&gt;</span> <span class="fu">filter</span>(Book.Author <span class="sc">==</span> <span class="st">"stephen king"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">group_by</span>(Publisher) <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">summarise</span>(<span class="at">book_count =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">arrange</span>(<span class="fu">desc</span>(book_count)) <span class="sc">|&gt;</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   Publisher            book_count
   &lt;chr&gt;                     &lt;int&gt;
 1 signet book                1230
 2 pocket                      526
 3 viking books                280
 4 scribner                    272
 5 new amer library            206
 6 new american library        107
 7 plume books                  88
 8 heyne                        80
 9 penguin putnam~mass          75
10 ballantine books             68</code></pre>
</div>
</div>
<p>You see. Signet Book has published many of Stephen King’s highly rated books. This partly explains the high rating among the users.</p>
</section>
</section>
<section id="which-year-of-publication-is-highly-rated" class="level2">
<h2 class="anchored" data-anchor-id="which-year-of-publication-is-highly-rated">Which year of publication is highly rated ?</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>ratings_new <span class="sc">|&gt;</span> <span class="fu">group_by</span>(Year.Of.Publication) <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>               <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(Book.Rating)) <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>               <span class="fu">arrange</span>(<span class="fu">desc</span>(count))<span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">20</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year.Of.Publication, <span class="at">y =</span> count)) <span class="sc">+</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>               <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>               <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Publication Year"</span>, </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> <span class="st">"User Rating Count"</span>, </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">title =</span> <span class="st">"Readers highly rate recently published books more"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="BGTSIM001_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="what-books-do-youth-read-and-enjoy-what-about-the-old-aged-user" class="level2">
<h2 class="anchored" data-anchor-id="what-books-do-youth-read-and-enjoy-what-about-the-old-aged-user">What books do youth read and enjoy ? What about the old-aged user ?</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>ratings_new <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">filter</span>(Age <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">40</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">group_by</span>(Book.Title) <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(Book.Rating)) <span class="sc">|&gt;</span> </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">|&gt;</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Book.Title, <span class="at">y =</span> count)) <span class="sc">+</span> </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"gold"</span>) <span class="sc">+</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">50</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Book Title"</span>, </span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> <span class="st">"User Rating Count"</span>,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">title =</span> <span class="st">"Youth readers prefer mystery, fantasy and coming-of-age books"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="BGTSIM001_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># old people?</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>ratings_new <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">filter</span>(Age <span class="sc">&gt;=</span> <span class="dv">41</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">group_by</span>(Book.Title) <span class="sc">|&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(Book.Rating)) <span class="sc">|&gt;</span> </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">|&gt;</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Book.Title, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"brown"</span>) <span class="sc">+</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">50</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Book Title"</span>, </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> <span class="st">"User Rating Count"</span>,</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">title =</span> <span class="st">"Old readers prefer historical, military fiction and war books"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="BGTSIM001_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Looking across the youth and old users, The Lovely Bones by Alice Sebold and The da Vinci Code by Dan Brown are the commonly read and enjoyed books.</p>
</section>
<section id="user-based-collaborative-filtering" class="level2">
<h2 class="anchored" data-anchor-id="user-based-collaborative-filtering">User-Based Collaborative Filtering</h2>
<p>This approach operates on a premise that users who gave a similar ratings to a certain book are likely to have the same preference for other books as well. Therefore, this method relies heavily on finding similarity between users. The workflow below illustrates user to user collaborative filtering:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-3454811298.png" class="img-fluid figure-img"></p>
<figcaption>User to user CF</figcaption>
</figure>
</div>
<section id="subset-the-data-first-then-use-it-to-all-three-approaches." class="level3">
<h3 class="anchored" data-anchor-id="subset-the-data-first-then-use-it-to-all-three-approaches.">Subset the data first, then use it to all three approaches.</h3>
<p>The dataset is quite huge as you have noticed. It was decided to subset it such that we focus on top 100 books from top 20 publishing companies, and our users are American Youth (18 to 35 years old)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># top 20 books from top 20 publishing companies</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>new_books  <span class="ot">=</span> ratings_explicit <span class="sc">|&gt;</span> <span class="fu">filter</span>(Publisher <span class="sc">%in%</span> pub_companies<span class="sc">$</span>Publisher) <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">group_by</span>(Book.Title) <span class="sc">|&gt;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(Book.Rating)) <span class="sc">|&gt;</span> </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">50</span>)<span class="sc">|&gt;</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">select</span>(Book.Title, count)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>final_book <span class="ot">=</span> ratings_explicit <span class="sc">|&gt;</span> <span class="fu">filter</span>(Book.Title <span class="sc">%in%</span> new_books<span class="sc">$</span>Book.Title) <span class="sc">|&gt;</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">filter</span>(Age <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;=</span> <span class="dv">35</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">filter</span>(countries <span class="sc">==</span> <span class="st">" usa"</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if any users rated the same book multiple times</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>duplicates <span class="ot">&lt;-</span> final_book <span class="sc">|&gt;</span> </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">select</span>(User.ID,Book.Title,Book.Rating) <span class="sc">|&gt;</span> </span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">group_by</span>(User.ID, Book.Title) <span class="sc">|&gt;</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the duplicates by averaging over the book ratings </span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>final_book <span class="ot">=</span> final_book <span class="sc">|&gt;</span> </span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">group_by</span>(User.ID, Book.Title) <span class="sc">|&gt;</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">summarize</span>(<span class="at">Book.Rating=</span> <span class="fu">mean</span>(Book.Rating, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">ungroup</span>() </span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot the data to be wider format</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>ratings_wider <span class="ot">=</span> final_book <span class="sc">|&gt;</span> </span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Book.Title, </span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> Book.Rating, </span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_fill =</span> <span class="fu">list</span>(<span class="at">Book.Rating =</span> <span class="dv">0</span>)) <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="cosine-similarity-function" class="level3">
<h3 class="anchored" data-anchor-id="cosine-similarity-function">Cosine similarity function</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>cosine_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossprod</span>(a, b) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">crossprod</span>(a) <span class="sc">*</span> <span class="fu">crossprod</span>(b))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="construct-the-user-similarities-matrix" class="level3">
<h3 class="anchored" data-anchor-id="construct-the-user-similarities-matrix">Construct the user similarities matrix</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>user_similarities <span class="ot">=</span> <span class="cf">function</span>(data){</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># construct an empty matrix</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  user_similarities <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(data), <span class="at">ncol =</span> <span class="fu">nrow</span>(data))</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute cosine similarity for between users</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(data) <span class="sc">-</span> <span class="dv">1</span>)){</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> (i <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(ratings_wider)){</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    user_similarities[i, j] <span class="ot">&lt;-</span> <span class="fu">cosine_sim</span>(data[i, ], data[j, ])</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arrange the user similarity matrix </span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  user_similarities            <span class="ot">&lt;-</span> user_similarities <span class="sc">+</span> <span class="fu">t</span>(user_similarities)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diag</span>(user_similarities)      <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row.names</span>(user_similarities) <span class="ot">&lt;-</span> data[,<span class="dv">1</span>]</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(user_similarities)  <span class="ot">&lt;-</span> data[,<span class="dv">1</span>]</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># round to 4 decimal places</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  user_similarities <span class="ot">=</span> user_similarities <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">4</span>)</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return the dataframe</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(user_similarities<span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>())</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a><span class="co"># print the user similarities to check?</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">user_similarities</span>(ratings_wider)[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">254</th>
<th style="text-align: right;">388</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">254</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.9943</td>
</tr>
<tr class="even">
<td style="text-align: left;">388</td>
<td style="text-align: right;">0.9943</td>
<td style="text-align: right;">0.0000</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="build-a-uu-recommender-function" class="level3">
<h3 class="anchored" data-anchor-id="build-a-uu-recommender-function">Build a UU recommender function</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build a recommender function that takes the userID and wide ratings data </span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>UU_recommender <span class="ot">=</span> <span class="cf">function</span>(userID, data,<span class="at">min_rating =</span> <span class="dv">0</span>, <span class="at">max_rating =</span> <span class="dv">10</span>){</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(userID <span class="sc">%in%</span> <span class="fu">unique</span>(<span class="fu">as.data.frame</span>(data)<span class="sc">$</span>User.ID)){</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    user_scores <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="fu">colnames</span>(data),</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">score =</span> <span class="fu">as.vector</span>(</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">as.matrix</span>(<span class="fu">user_similarities</span>(data)[userID, ]) <span class="sc">%*%</span> data),</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">read =</span> <span class="fu">as.vector</span>(data[<span class="fu">which</span>(data[,<span class="st">"User.ID"</span>] <span class="sc">==</span> userID), ])</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Normalize the scores between [min_rating, max_rating]</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    min_score <span class="ot">&lt;-</span> <span class="fu">min</span>(user_scores<span class="sc">$</span>score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    max_score <span class="ot">&lt;-</span> <span class="fu">max</span>(user_scores<span class="sc">$</span>score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    user_scores<span class="sc">$</span>USB.Rating <span class="ot">&lt;-</span> <span class="fu">round</span>((user_scores<span class="sc">$</span>score <span class="sc">-</span> min_score) <span class="sc">*</span> </span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>                                    ((max_rating <span class="sc">-</span> min_rating) <span class="sc">/</span> (max_score <span class="sc">-</span> min_score))<span class="sc">*</span><span class="dv">100000</span>,<span class="dv">0</span>)</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return recommendations, incl. those read</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(user_scores <span class="sc">|&gt;</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>               <span class="fu">arrange</span>(<span class="fu">desc</span>(USB.Rating))</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"User not found in our database. Try again!"</span>)</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="recommend-a-new-book-using-user-user-cf-to-a-user" class="level3">
<h3 class="anchored" data-anchor-id="recommend-a-new-book-using-user-user-cf-to-a-user">Recommend a new book using User-User CF to a user</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># recommend books to user 2399</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">UU_recommender</span>(<span class="st">"2399"</span>, ratings_wider) <span class="sc">|&gt;</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(read <span class="sc">==</span> <span class="dv">0</span>)<span class="sc">|&gt;</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>read))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 73%">
<col style="width: 12%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">title</th>
<th style="text-align: right;">score</th>
<th style="text-align: right;">USB.Rating</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">harry potter and the chamber of secrets (book 2)</td>
<td style="text-align: right;">1001.9487</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">harry potter and the goblet of fire (book 4)</td>
<td style="text-align: right;">850.9487</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">harry potter and the prisoner of azkaban (book 3)</td>
<td style="text-align: right;">920.9487</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">divine secrets of the ya-ya sisterhood: a novel</td>
<td style="text-align: right;">826.9991</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bridget jones’s diary</td>
<td style="text-align: right;">845.0000</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">1984</td>
<td style="text-align: right;">599.9487</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">she’s come undone (oprah’s book club)</td>
<td style="text-align: right;">656.9595</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">the secret life of bees</td>
<td style="text-align: right;">775.9487</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">harry potter and the order of the phoenix (book 5)</td>
<td style="text-align: right;">779.0000</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">where the heart is (oprah’s book club (paperback))</td>
<td style="text-align: right;">621.0000</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">american gods</td>
<td style="text-align: right;">447.9430</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">harry potter and the sorcerer’s stone (book 1)</td>
<td style="text-align: right;">585.9487</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">little altars everywhere: a novel</td>
<td style="text-align: right;">379.9992</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">a time to kill</td>
<td style="text-align: right;">520.9946</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">a walk to remember</td>
<td style="text-align: right;">446.9946</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">snow falling on cedars</td>
<td style="text-align: right;">383.9930</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">suzanne’s diary for nicholas</td>
<td style="text-align: right;">425.9940</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">summer sisters</td>
<td style="text-align: right;">576.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the hitchhiker’s guide to the galaxy</td>
<td style="text-align: right;">411.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">a painted house</td>
<td style="text-align: right;">487.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">timeline</td>
<td style="text-align: right;">388.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">watership down</td>
<td style="text-align: right;">415.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the girls’ guide to hunting and fishing</td>
<td style="text-align: right;">505.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">red dragon</td>
<td style="text-align: right;">493.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the runaway jury</td>
<td style="text-align: right;">380.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">the poisonwood bible: a novel</td>
<td style="text-align: right;">408.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the chamber</td>
<td style="text-align: right;">360.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">the vampire lestat (vampire chronicles, book ii)</td>
<td style="text-align: right;">523.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the client</td>
<td style="text-align: right;">423.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">the pelican brief</td>
<td style="text-align: right;">414.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the summons</td>
<td style="text-align: right;">364.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">jurassic park</td>
<td style="text-align: right;">579.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the bridges of madison county</td>
<td style="text-align: right;">397.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">the notebook</td>
<td style="text-align: right;">543.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fast food nation: the dark side of the all-american meal</td>
<td style="text-align: right;">388.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">a prayer for owen meany</td>
<td style="text-align: right;">394.0000</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">neverwhere</td>
<td style="text-align: right;">299.9430</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">the partner</td>
<td style="text-align: right;">332.9992</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the rescue</td>
<td style="text-align: right;">295.9946</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">the bean trees</td>
<td style="text-align: right;">341.0000</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sphere</td>
<td style="text-align: right;">304.0000</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">the horse whisperer</td>
<td style="text-align: right;">301.0000</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hearts in atlantis</td>
<td style="text-align: right;">246.0000</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">bel canto: a novel</td>
<td style="text-align: right;">309.0000</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">one door away from heaven</td>
<td style="text-align: right;">243.5000</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">the testament</td>
<td style="text-align: right;">330.0000</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the divine secrets of the ya-ya sisterhood: a novel</td>
<td style="text-align: right;">284.0000</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">a bend in the road</td>
<td style="text-align: right;">288.0000</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the cider house rules</td>
<td style="text-align: right;">268.0000</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>User 2399 might enjoy <strong>excessive</strong> amounts of Harry Potter books.</p>
</section>
</section>
<section id="item-based-collaborative-filtering" class="level2">
<h2 class="anchored" data-anchor-id="item-based-collaborative-filtering">Item-Based Collaborative Filtering</h2>
<p>The previous approach assumed that users are the same! Which is quite incorrect. On top of that, in some cases, user preference might be too abstract to break down. This is where item-based CF can be useful. Here, the basic idea is that Book <strong>A</strong> is similar to Book <strong>B</strong> if users who see <strong>A</strong> also tend to see <strong>B.</strong></p>
<p>Similarity between books is used instead of similarity between users.</p>
<p>We first need to convert the data to matrix form otherwise some of the later functions we use will give an error.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot the data</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>ratings_wider_item <span class="ot">=</span> final_book <span class="sc">|&gt;</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(User.ID, Book.Title, Book.Rating) <span class="sc">|&gt;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Book.Title, </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> Book.Rating, </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_fill =</span> <span class="fu">list</span>(<span class="at">Book.Rating =</span> <span class="dv">0</span>))</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>sorted_my_users <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">unlist</span>(ratings_wider_item[, <span class="dv">1</span>]))</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>ratings_wider_item  <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(ratings_wider_item[, <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(ratings_wider_item) <span class="ot">&lt;-</span> sorted_my_users</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="construct-the-item-similarities-matrix" class="level3">
<h3 class="anchored" data-anchor-id="construct-the-item-similarities-matrix">Construct the item similarities matrix</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create an empty matrix</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>item_similarities <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">ncol</span>(ratings_wider_item), <span class="at">ncol =</span> <span class="fu">ncol</span>(ratings_wider_item))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute similarities between items</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(ratings_wider_item) <span class="sc">-</span> <span class="dv">1</span>)){</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> (i <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">ncol</span>(ratings_wider_item)){</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>      item_similarities[i, j] <span class="ot">&lt;-</span> <span class="fu">cosine_sim</span>(ratings_wider_item[, i], ratings_wider_item[, j])</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange the book similarity matrix </span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>item_similarities            <span class="ot">&lt;-</span> item_similarities <span class="sc">+</span> <span class="fu">t</span>(item_similarities)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(item_similarities)      <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(item_similarities) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(ratings_wider_item)</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(item_similarities)  <span class="ot">&lt;-</span> <span class="fu">colnames</span>(ratings_wider_item)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(item_similarities[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="dv">2</span>)</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">1984</th>
<th style="text-align: right;">american gods</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1984</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.06</td>
</tr>
<tr class="even">
<td style="text-align: left;">american gods</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.00</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="build-a-item-item-recommendation-function-for-any-user" class="level3">
<h3 class="anchored" data-anchor-id="build-a-item-item-recommendation-function-for-any-user">Build a Item-Item recommendation function for any user</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>II_recommender <span class="ot">&lt;-</span> <span class="cf">function</span>(ratings, user, book_sim, read_bk,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">min_rating =</span> <span class="dv">0</span>,<span class="at">max_rating =</span> <span class="dv">10</span>) {</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># turn into character, if not already</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  user <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.character</span>(user), user, <span class="fu">as.character</span>(user))</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get scores</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  user_read <span class="ot">&lt;-</span> ratings <span class="sc">|&gt;</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">filter</span>(User.ID <span class="sc">==</span> user) <span class="sc">|&gt;</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">pull</span>(Book.Title)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(user_read) <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    user_scores <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">row.names</span>(book_sim),</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">score =</span> book_sim[, user_read],</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">read =</span> read_bk[user, ]</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>{</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>    user_scores <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">row.names</span>(book_sim),</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">score =</span> <span class="fu">apply</span>(book_sim[, user_read], <span class="dv">1</span>, sum),</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">read =</span> read_bk[user, ]</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Normalize the scores between [min_rating, max_rating]</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>  min_score <span class="ot">&lt;-</span> <span class="fu">min</span>(user_scores<span class="sc">$</span>score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>  max_score <span class="ot">&lt;-</span> <span class="fu">max</span>(user_scores<span class="sc">$</span>score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>  user_scores<span class="sc">$</span>ITB.Rating <span class="ot">&lt;-</span> <span class="fu">round</span>((user_scores<span class="sc">$</span>score <span class="sc">-</span> min_score) <span class="sc">*</span> </span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>                                    ((max_rating <span class="sc">-</span> min_rating) <span class="sc">/</span> (max_score <span class="sc">-</span> min_score)),<span class="dv">0</span>)</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return recommendations. incl. the ones read. </span></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(user_scores <span class="sc">|&gt;</span></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(ITB.Rating))</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can use this similarity matrix to discover which books are similar to “iInterview with the Vampire”.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>item_similarities[, <span class="st">"interview with the vampire"</span>] <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">similarity =</span> _) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">similarity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">the vampire lestat (vampire chronicles, book ii)</td>
<td style="text-align: right;">0.4009141</td>
</tr>
<tr class="even">
<td style="text-align: left;">harry potter and the prisoner of azkaban (book 3)</td>
<td style="text-align: right;">0.1087830</td>
</tr>
<tr class="odd">
<td style="text-align: left;">harry potter and the chamber of secrets (book 2)</td>
<td style="text-align: right;">0.0991469</td>
</tr>
<tr class="even">
<td style="text-align: left;">jurassic park</td>
<td style="text-align: right;">0.0911109</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1984</td>
<td style="text-align: right;">0.0905935</td>
</tr>
<tr class="even">
<td style="text-align: left;">the chamber</td>
<td style="text-align: right;">0.0902467</td>
</tr>
<tr class="odd">
<td style="text-align: left;">a time to kill</td>
<td style="text-align: right;">0.0876523</td>
</tr>
<tr class="even">
<td style="text-align: left;">harry potter and the goblet of fire (book 4)</td>
<td style="text-align: right;">0.0835883</td>
</tr>
<tr class="odd">
<td style="text-align: left;">harry potter and the sorcerer’s stone (book 1)</td>
<td style="text-align: right;">0.0787755</td>
</tr>
<tr class="even">
<td style="text-align: left;">the testament</td>
<td style="text-align: right;">0.0761352</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Interview with the Vampire (IwV) by Anna Rice, published in 1976 is <em>quite</em> similar to The Vampire Lestat (TVL) and Harry Potter books. So if a user prefers IwV, you would recommend Harry Potter’s books and the TVL. TVL mostly.</p>
</section>
<section id="book-recommendations-using-item-item-cf" class="level3">
<h3 class="anchored" data-anchor-id="book-recommendations-using-item-item-cf">Book recommendations using Item-Item CF</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># recommend books to user 2399</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">II_recommender</span>(<span class="at">ratings =</span> final_book,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">user =</span> <span class="st">"2399"</span>, </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">book_sim =</span> item_similarities, </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">read_bk =</span> ratings_wider_item) <span class="sc">|&gt;</span> </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">filter</span>(read <span class="sc">==</span> <span class="dv">0</span>)    <span class="do">## books they haven't read</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 68%">
<col style="width: 12%">
<col style="width: 6%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">title</th>
<th style="text-align: right;">score</th>
<th style="text-align: right;">read</th>
<th style="text-align: right;">ITB.Rating</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">the vampire lestat (vampire chronicles, book ii)</td>
<td style="text-align: right;">0.4009141</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">harry potter and the prisoner of azkaban (book 3)</td>
<td style="text-align: right;">0.1087830</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1984</td>
<td style="text-align: right;">0.0905935</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">harry potter and the chamber of secrets (book 2)</td>
<td style="text-align: right;">0.0991469</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">harry potter and the goblet of fire (book 4)</td>
<td style="text-align: right;">0.0835883</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">harry potter and the sorcerer’s stone (book 1)</td>
<td style="text-align: right;">0.0787755</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">a time to kill</td>
<td style="text-align: right;">0.0876523</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">harry potter and the order of the phoenix (book 5)</td>
<td style="text-align: right;">0.0723521</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">red dragon</td>
<td style="text-align: right;">0.0706991</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">the chamber</td>
<td style="text-align: right;">0.0902467</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">jurassic park</td>
<td style="text-align: right;">0.0911109</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">the testament</td>
<td style="text-align: right;">0.0761352</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">american gods</td>
<td style="text-align: right;">0.0503747</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">she’s come undone (oprah’s book club)</td>
<td style="text-align: right;">0.0266550</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the partner</td>
<td style="text-align: right;">0.0397277</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">snow falling on cedars</td>
<td style="text-align: right;">0.0268582</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">divine secrets of the ya-ya sisterhood: a novel</td>
<td style="text-align: right;">0.0521799</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">summer sisters</td>
<td style="text-align: right;">0.0421143</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the hitchhiker’s guide to the galaxy</td>
<td style="text-align: right;">0.0566398</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">a painted house</td>
<td style="text-align: right;">0.0534634</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the girls’ guide to hunting and fishing</td>
<td style="text-align: right;">0.0253292</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">where the heart is (oprah’s book club (paperback))</td>
<td style="text-align: right;">0.0487454</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the runaway jury</td>
<td style="text-align: right;">0.0548292</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">the poisonwood bible: a novel</td>
<td style="text-align: right;">0.0470966</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the client</td>
<td style="text-align: right;">0.0239642</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">the pelican brief</td>
<td style="text-align: right;">0.0534217</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the summons</td>
<td style="text-align: right;">0.0546314</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">bridget jones’s diary</td>
<td style="text-align: right;">0.0536689</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the bridges of madison county</td>
<td style="text-align: right;">0.0556155</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">the horse whisperer</td>
<td style="text-align: right;">0.0334306</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hearts in atlantis</td>
<td style="text-align: right;">0.0328380</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">fast food nation: the dark side of the all-american meal</td>
<td style="text-align: right;">0.0265604</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">one door away from heaven</td>
<td style="text-align: right;">0.0440005</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">the cider house rules</td>
<td style="text-align: right;">0.0368252</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">neverwhere</td>
<td style="text-align: right;">0.0126587</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">the secret life of bees</td>
<td style="text-align: right;">0.0142295</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">little altars everywhere: a novel</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">a walk to remember</td>
<td style="text-align: right;">0.0135125</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">suzanne’s diary for nicholas</td>
<td style="text-align: right;">0.0075004</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">the rescue</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">timeline</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">watership down</td>
<td style="text-align: right;">0.0169163</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the bean trees</td>
<td style="text-align: right;">0.0154765</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">sphere</td>
<td style="text-align: right;">0.0150021</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the notebook</td>
<td style="text-align: right;">0.0170672</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">bel canto: a novel</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">a prayer for owen meany</td>
<td style="text-align: right;">0.0117760</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">the divine secrets of the ya-ya sisterhood: a novel</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">a bend in the road</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Still. User 2399 might relatively enjoy more of TVL. At times, suggest Harry Potter’s books. They might <em>somewhat</em> have a taste there.</p>
</section>
</section>
<section id="matrix-factorization-cf" class="level2">
<h2 class="anchored" data-anchor-id="matrix-factorization-cf">Matrix Factorization CF</h2>
<p>This method is a contrast to user and item-based filtering through a creation of predictive machine learning model of the data. The method uses present values in the user-item matrix as the training data set and produces predictions for missing values with the resultant model.</p>
<p>Essentially, matrix factorization algorithms work by decomposing the user-item interaction (book ratings in our case) into the product of two lower dimensionality matrices called factors, i.e., user and book factors: the idea is to represent users and items in a lower dimensional space.</p>
<p>To do this, <a href="https://rdrr.io/cran/recosystem/f/vignettes/introduction.Rmd"><em>recosystem</em></a> package is used to apply this algorithm. Firstly, the package requires that UserID and ISBN should be integers starting at 0 or 1.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>userIds <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">User.ID =</span> <span class="fu">unique</span>(final_book<span class="sc">$</span>User.ID),</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">new_userId =</span> <span class="dv">0</span><span class="sc">:</span>(<span class="fu">length</span>(<span class="fu">unique</span>(final_book<span class="sc">$</span>User.ID)) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>bookIds <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">Book.Title =</span> <span class="fu">unique</span>(final_book<span class="sc">$</span>Book.Title),</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">new_bookId =</span> <span class="dv">0</span><span class="sc">:</span>(<span class="fu">length</span>(<span class="fu">unique</span>(final_book<span class="sc">$</span>Book.Title)) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>final_book <span class="ot">=</span> final_book <span class="sc">|&gt;</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">left_join</span>(userIds) <span class="sc">|&gt;</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">left_join</span>(bookIds)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>final_book <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="at">User.ID =</span> new_userId, </span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Book.ID =</span> new_bookId, </span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>                     Book.Title,</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>                     Book.Rating) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 64%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">User.ID</th>
<th style="text-align: right;">Book.ID</th>
<th style="text-align: left;">Book.Title</th>
<th style="text-align: right;">Book.Rating</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">1984</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">american gods</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">harry potter and the chamber of secrets (book 2)</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">harry potter and the goblet of fire (book 4)</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">harry potter and the prisoner of azkaban (book 3)</td>
<td style="text-align: right;">9</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="split-the-data-into-training-and-test-set" class="level3">
<h3 class="anchored" data-anchor-id="split-the-data-into-training-and-test-set">Split the data into training and test set</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>set   <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(final_book), <span class="at">size =</span> <span class="fl">0.8</span><span class="sc">*</span><span class="fu">nrow</span>(final_book))</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>train <span class="ot">=</span> final_book[set,]</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>test  <span class="ot">=</span> final_book[<span class="sc">-</span>set, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="train-and-predict-on-a-test-set" class="level3">
<h3 class="anchored" data-anchor-id="train-and-predict-on-a-test-set">Train and predict on a test set</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Format data for recosystem</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>reco_train <span class="ot">&lt;-</span> <span class="fu">data_memory</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">user_index =</span> train<span class="sc">$</span>new_userId,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">item_index =</span> train<span class="sc">$</span>new_bookId,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rating =</span> train<span class="sc">$</span>Book.Rating</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>reco_test <span class="ot">&lt;-</span> <span class="fu">data_memory</span>(</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">user_index =</span> test<span class="sc">$</span>new_userId,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">item_index =</span> test<span class="sc">$</span>new_bookId,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">rating =</span> test<span class="sc">$</span>Book.Rating</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Reco model</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>rs <span class="ot">&lt;-</span> <span class="fu">Reco</span>()</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune model for hyperparameters on training data</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>opts <span class="ot">&lt;-</span> rs<span class="sc">$</span><span class="fu">tune</span>(reco_train, <span class="at">opts =</span> <span class="fu">list</span>(</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>),        <span class="co"># the dimensions of the latent factor matrices</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">lrate =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.01</span>),</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">niter =</span> <span class="dv">20</span>,</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">nmf =</span> <span class="cn">TRUE</span>, </span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">nthread =</span> <span class="dv">4</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model with optimal hyperparameters</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>rs<span class="sc">$</span><span class="fu">train</span>(reco_train, <span class="at">opts =</span> <span class="fu">list</span>(</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>    opts<span class="sc">$</span>min,</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">niter =</span> <span class="dv">50</span>, </span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">nthread =</span> <span class="dv">4</span>,</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions on the test set for this fold</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>MF_pred <span class="ot">&lt;-</span> rs<span class="sc">$</span><span class="fu">predict</span>(reco_test)</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a><span class="co"># prediction </span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>pred_data <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MF.Rating =</span> MF_pred <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">1</span>)) </span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>pred_data <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 7%">
<col style="width: 49%">
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">User.ID</th>
<th style="text-align: left;">Book.Title</th>
<th style="text-align: right;">Book.Rating</th>
<th style="text-align: right;">new_userId</th>
<th style="text-align: right;">new_bookId</th>
<th style="text-align: right;">MF.Rating</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">254</td>
<td style="text-align: left;">harry potter and the sorcerer’s stone (book 1)</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">9.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">638</td>
<td style="text-align: left;">the rescue</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">9.0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">882</td>
<td style="text-align: left;">snow falling on cedars</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">8.1</td>
</tr>
<tr class="even">
<td style="text-align: right;">900</td>
<td style="text-align: left;">divine secrets of the ya-ya sisterhood: a novel</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">8.1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1511</td>
<td style="text-align: left;">the hitchhiker’s guide to the galaxy</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">8.1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1530</td>
<td style="text-align: left;">a painted house</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">8.1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2033</td>
<td style="text-align: left;">harry potter and the goblet of fire (book 4)</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">8.9</td>
</tr>
<tr class="even">
<td style="text-align: right;">2033</td>
<td style="text-align: left;">harry potter and the order of the phoenix (book 5)</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">8.5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2033</td>
<td style="text-align: left;">harry potter and the sorcerer’s stone (book 1)</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">8.8</td>
</tr>
<tr class="even">
<td style="text-align: right;">2977</td>
<td style="text-align: left;">she’s come undone (oprah’s book club)</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">8.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="assess-accuracy-on-the-test-set" class="level3">
<h3 class="anchored" data-anchor-id="assess-accuracy-on-the-test-set">Assess accuracy on the test set</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>evaluation <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Model =</span> <span class="st">"Matrix CF"</span>,</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">MAE  =</span> <span class="fu">round</span>(Metrics<span class="sc">::</span><span class="fu">mae</span>(test<span class="sc">$</span>Book.Rating, MF_pred),<span class="dv">2</span>),</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">MSE  =</span> <span class="fu">round</span>(Metrics<span class="sc">::</span><span class="fu">mse</span>(test<span class="sc">$</span>Book.Rating, MF_pred),<span class="dv">2</span>),</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">RMSE =</span> <span class="fu">round</span>(Metrics<span class="sc">::</span><span class="fu">rmse</span>(test<span class="sc">$</span>Book.Rating, MF_pred),<span class="dv">2</span>))</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(evaluation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">MAE</th>
<th style="text-align: right;">MSE</th>
<th style="text-align: right;">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Matrix CF</td>
<td style="text-align: right;">1.31</td>
<td style="text-align: right;">3.06</td>
<td style="text-align: right;">1.75</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="build-a-regularized-matrix-factorization-cf" class="level3">
<h3 class="anchored" data-anchor-id="build-a-regularized-matrix-factorization-cf">Build a regularized matrix factorization CF</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Reco model</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>rs <span class="ot">&lt;-</span> <span class="fu">Reco</span>()</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune model for hyperparameters on training data</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>opts <span class="ot">&lt;-</span> rs<span class="sc">$</span><span class="fu">tune</span>(reco_train, <span class="at">opts =</span> <span class="fu">list</span>(</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>),</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="at">lrate =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span>),</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="at">niter =</span> <span class="dv">20</span>,</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="at">nmf     =</span> <span class="cn">TRUE</span>, </span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="at">nthread  =</span> <span class="dv">4</span>, </span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="at">costp_l2 =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.25</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span>), <span class="co"># the L2 regularization cost for user factors</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="at">costq_l2 =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.25</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span>)  <span class="co"># the L2 regularization cost for book factors</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model with optimal hyperparameters</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>rs<span class="sc">$</span><span class="fu">train</span>(reco_train, <span class="at">opts =</span> <span class="fu">list</span>(</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>    opts<span class="sc">$</span>min,</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">niter =</span> <span class="dv">50</span>, </span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">nthread =</span> <span class="dv">4</span>,</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions on the test set for this fold</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>MF_pred <span class="ot">&lt;-</span> rs<span class="sc">$</span><span class="fu">predict</span>(reco_test)</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a><span class="co"># prediction </span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>pred_data <span class="ot">&lt;-</span> test <span class="sc">|&gt;</span> </span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MF.Rating =</span> MF_pred <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">1</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="assess-accuracy-with-regularization" class="level3">
<h3 class="anchored" data-anchor-id="assess-accuracy-with-regularization">Assess accuracy with regularization</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>evaluation <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(evaluation, <span class="fu">tibble</span>(<span class="at">Model =</span> <span class="st">"regularised Matrix CF"</span>,</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">MAE  =</span> <span class="fu">round</span>(Metrics<span class="sc">::</span><span class="fu">mae</span>(test<span class="sc">$</span>Book.Rating, MF_pred),<span class="dv">2</span>),</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">MSE  =</span> <span class="fu">round</span>(Metrics<span class="sc">::</span><span class="fu">mse</span>(test<span class="sc">$</span>Book.Rating, MF_pred),<span class="dv">2</span>),</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">RMSE =</span> <span class="fu">round</span>(Metrics<span class="sc">::</span><span class="fu">rmse</span>(test<span class="sc">$</span>Book.Rating, MF_pred),<span class="dv">2</span>)))</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(evaluation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">MAE</th>
<th style="text-align: right;">MSE</th>
<th style="text-align: right;">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Matrix CF</td>
<td style="text-align: right;">1.31</td>
<td style="text-align: right;">3.06</td>
<td style="text-align: right;">1.75</td>
</tr>
<tr class="even">
<td style="text-align: left;">regularised Matrix CF</td>
<td style="text-align: right;">1.29</td>
<td style="text-align: right;">2.93</td>
<td style="text-align: right;">1.71</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>It appears if you regularize the matrix CF, the model performance slightly improves on all metrics. But, this is not a full picture, as this is was done on one test set.</li>
</ul>
</section>
</section>
<section id="ensemble-the-predictions-from-user-user-item-item-and-matrix-cf" class="level2">
<h2 class="anchored" data-anchor-id="ensemble-the-predictions-from-user-user-item-item-and-matrix-cf">Ensemble the predictions from User-User, Item-Item and Matrix CF</h2>
<p>To do this, we get predictions of all the three approaches from a single user, and then get the average. This is will be the ensemble predicted rating of a particular book for that user.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find a user from within the test predictions of matrix factorization method</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>MF_data <span class="ot">=</span> pred_data <span class="sc">|&gt;</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">filter</span>(User.ID <span class="sc">==</span> <span class="st">"13552"</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co"># recommend books to user 2399 and get prediction from the normalised scores</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>item <span class="ot">=</span> <span class="fu">II_recommender</span>(<span class="at">ratings =</span> final_book,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">user =</span> <span class="st">"13552"</span>, </span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">book_sim =</span> item_similarities, </span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">read_bk =</span> ratings_wider_item) <span class="sc">|&gt;</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">select</span>(title,ITB.Rating)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>user <span class="ot">=</span> <span class="fu">UU_recommender</span>(<span class="st">"13552"</span>, ratings_wider) <span class="sc">|&gt;</span> </span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">select</span>(title, USB.Rating)</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co"># join the three approaches for user 2399</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>item_user    <span class="ot">=</span> <span class="fu">inner_join</span>(item, user) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">Book.Title =</span> title)</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>item_user_mf <span class="ot">=</span> <span class="fu">inner_join</span>(item_user,MF_data, <span class="at">by =</span> <span class="st">"Book.Title"</span>)</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming the dataframe is named books_ratings</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>item_user_mf<span class="sc">$</span>ensemble_model <span class="ot">=</span>  <span class="fu">round</span>(<span class="fu">rowMeans</span>(item_user_mf[, <span class="fu">c</span>(<span class="st">"ITB.Rating"</span>, </span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>                                                                <span class="st">"USB.Rating"</span>,</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>                                                                <span class="st">"MF.Rating"</span>)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>item_user_mf <span class="ot">=</span> item_user_mf <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>Book.Rating)</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a><span class="co"># get the average true rating for that book. </span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>mean_rating <span class="ot">=</span> ratings_explicit <span class="sc">|&gt;</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Book.Title) <span class="sc">|&gt;</span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_rating =</span> <span class="fu">round</span>(<span class="fu">mean</span>(Book.Rating))) <span class="sc">|&gt;</span></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(mean_rating) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>final_models <span class="ot">=</span> <span class="fu">inner_join</span>(mean_rating, item_user_mf , <span class="at">by =</span> <span class="st">"Book.Title"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><p>Here, this ensemble method proposed seems to by chance, because it’s quite hard to find the same user-book interaction from the three approaches simultaneously.</p></li>
<li><p>The data is sampled when splitting into a test set, and then again when recommendations are being done. This makes quite impossible to match the user-book interaction. It can only happen by chance.</p></li>
<li><p>Maybe there is another way to do this. I am open to learning it.</p></li>
</ul>
<section id="evaluate-the-accuracy-of-the-ensemble-predictions" class="level3">
<h3 class="anchored" data-anchor-id="evaluate-the-accuracy-of-the-ensemble-predictions">Evaluate the accuracy of the ensemble predictions</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluation </span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>evaluation <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(evaluation, <span class="fu">tibble</span>(<span class="at">Model =</span> <span class="st">"Ensemble Model"</span>,</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">MAE  =</span> Metrics<span class="sc">::</span><span class="fu">mae</span>(final_models<span class="sc">$</span>mean_rating, final_models<span class="sc">$</span>ensemble_model),</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">MSE  =</span> Metrics<span class="sc">::</span><span class="fu">mse</span>(final_models<span class="sc">$</span>mean_rating, final_models<span class="sc">$</span>ensemble_model),</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">RMSE =</span> Metrics<span class="sc">::</span><span class="fu">rmse</span>(final_models<span class="sc">$</span>mean_rating, final_models<span class="sc">$</span>ensemble_model)))</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(evaluation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">MAE</th>
<th style="text-align: right;">MSE</th>
<th style="text-align: right;">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Matrix CF</td>
<td style="text-align: right;">1.31</td>
<td style="text-align: right;">3.06</td>
<td style="text-align: right;">1.75</td>
</tr>
<tr class="even">
<td style="text-align: left;">regularised Matrix CF</td>
<td style="text-align: right;">1.29</td>
<td style="text-align: right;">2.93</td>
<td style="text-align: right;">1.71</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ensemble Model</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">9.00</td>
<td style="text-align: right;">3.00</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>From the table above, one can see that the ensemble predictions perform quite badly compared to the matrix factorization CF. It could be as a result of the two other approaches. But, also notice that the accuracy of the ensemble is based one user - it could be performing worse on that particular user and not generally on all users.</p>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This project attempts in great length the process of building a recommender system using three approaches: user and item-based collaborative filtering and matrix factorization (MF) algorithm. The dataset comes from the <a href="https://www.bookcrossing.com/">Book Crossing Community</a>, and its manipulated to find key insights, such as which books youth users in the community enjoy reading, and how is that different from older aged users - among other things. From these insights, we end up sub-setting the data towards information about youth (18-35 years old) Americans.</p>
<p>It is learned that when you regularize an MF algorithm, one could improve rating predictions, though marginally. At the end, an ensemble prediction is constructed for one user. It yields worse results for this particular user. Possibly, this is an impact of the user-user and item CFs in the ensemble.</p>
<p>We could improve on assessing how the change in MF’s latent factors’ dimensionality affects out of sample model performance. One could also explore how sensitive the model is to sampling variation and how accuracy changes with the number of users (and/or items) the model is based. Lastly, the ensemble prediction could include more users - one user is simply not enough to make robust conclusions.</p>
</section>
<section id="acknoweledgements" class="level2">
<h2 class="anchored" data-anchor-id="acknoweledgements">Acknoweledgements</h2>
<p>This recommendation system project was in close collaboration. Data Science project done isolation are painful. A special gratitude to Hlalumi Adams to accept to explore creative frontiers together.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>Aggarwal, C.C., 2016. <em>Recommender systems (Vol. 1)</em>. Cham: Springer International Publishing.</p>
<p>Calder, J. 2024. <em>Recommender Systems.</em> University of Cape Town. 28 August 2024.</p>
<p>Motefaker, A., 2024. <em>Movie Recommendation System using R</em> <em>- BEST</em>. Available at: https://www.kaggle.com/code/amirmotefaker/movie-recommendation-system-using-r-best/notebook#What-is-Movie-Recommendation? (Accessed: 25 September 2024)</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>